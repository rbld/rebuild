#!/usr/bin/env ruby

require 'pp'
require_relative '../lib/rbld_log'
require_relative '../lib/rbld_print'
require_relative '../lib/rbld_commands'
require_relative '../lib/rbld_list'
require_relative '../lib/rbld_status'
require_relative '../lib/rbld_rm'
require_relative '../lib/rbld_save'
require_relative '../lib/rbld_load'
require_relative '../lib/rbld_checkout'
require_relative '../lib/rbld_run'

begin

  rbld_log.info( "ARGV: #{ARGV.join(' ')}" )

  if !ARGV[0] || (ARGV[0] == "help" && !ARGV[1])
    puts Rebuild::Main.usage
    puts
    exit 0
  end

  if ARGV[0] == "help"
    Rebuild::Commands.usage( ARGV[1] )
    exit 0
  end

  if ARGV[1] == "--help" || ARGV[1] == "-h"
    Rebuild::Commands.usage( ARGV[0] )
    exit 0
  end

  Rebuild::Commands.run( ARGV[0], ARGV.drop(1) )
  exit 0

rescue Rebuild::CommandError => error
  exit error.code

rescue RuntimeError => msg
  rbld_print.error(msg)
  exit 1
end
